
#include "common.h"
#include "libxorscura.h"


int check_flag_1(char *query){

	//	char *flag_1_plaintext = "e0a77dac-3831-11e7-ab28-cf5332ffed5b";
	unsigned char flag_1_key[] = {0xe4,0x43,0x51,0x50,0xc2,0x18,0xe4,0x25,0x83,0xc7,0xe2,0x3c,0xfd,0xdb,0x1b,0x23,0x90,0x18,0xce,0x1c,0x1f,0xde,0xf2,0x20,0x36,0x5e,0x1d,0x63,0x95,0x27,0x16,0x10,0xd8,0xb5,0xde,0x13};
	unsigned char flag_1_ciphertext[] = {0x81,0x73,0x30,0x67,0xf5,0x7c,0x85,0x46,0xae,0xf4,0xda,0x0f,0xcc,0xf6,0x2a,0x12,0xf5,0x2f,0xe3,0x7d,0x7d,0xec,0xca,0x0d,0x55,0x38,0x28,0x50,0xa6,0x15,0x70,0x76,0xbd,0xd1,0xeb,0x71};

	int match = 0;
	struct xod *xor_data;


	if((xor_data = (struct xod *) calloc(1, sizeof(struct xod))) == NULL){
		error(-1, errno, "calloc(1, %d)", (int) sizeof(struct xod));
	}

	xor_data->buf_count = BUFFER_LEN;
	xor_data->key_buf = flag_1_key;
	xor_data->ciphertext_buf = flag_1_ciphertext;

	if(xorscura_decrypt(xor_data) == -1){
		error(-1, errno, "xorscura_decrypt(%lx)", (unsigned long) xor_data);
	}

	if(!strncmp((char *) xor_data->plaintext_buf, query, BUFFER_LEN)){
		match = 1;
	}

	xorscura_free_xod(xor_data);
	free(xor_data);

	return(match);
}
